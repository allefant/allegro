Import("context")
Import("env")
import addons, helpers

config = env.Configure()
settings = helpers.SimpleHash()

settings["ALLEGRO_CFG_IIO_HAVE_PNG"] = config.CheckHeader("png.h") and\
    config.CheckLib("png")

config.Finish()

helpers.parse_cmake_h(env,
    settings,
    "allegro5/internal/aintern_iio_cfg.h.cmake",
    "allegro5/internal/aintern_iio_cfg.h")

addons.do_build(
    context = context,
    env = env,
    source = ["bmp.c", "iio.c", "pcx.c", "tga.c", "png.c"],
    libs = ["png", "z"],
    dir = "iio",
    name = "a5_iio",
    install_headers = ["allegro5/a5_iio.h",
    "allegro5/internal/aintern_iio_cfg.h"]
)

x = True
Return("x")
